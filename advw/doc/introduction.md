<h1 align="center">My Advanced War</h1>

> `myadvancedwar` 是一个提供一款战旗游戏游戏的网站，网站中可以编写瓦片地图并发布到平台供其他玩家玩，也可以将多张地图加一些故事情节整合成一个战役，如果有任何感想，也可以将感想发布到平台，平台还支持联机对战、单人模式。

## 起因

由于怀念自任天堂的游戏《高级战争》，在接触编程之后就尝试着把它给做出来。

## 经过

之前尝试用python语言的pygame库、PyQt库进行开发，最终完成了游戏界面、游戏核心UI，地图编辑器、游戏所需的图片资源、网络，但所写的代码维护性差、不利于改动、还需要经历一番大的调整。也尝试过用`UE`开发，用UE可以省略许多底层的代码，但游戏的绝大多数代码都需要重新用c++或蓝图编写，当时没多少时间就直接暂停了。  
到了大二下学期，有点时间，在知乎上挑选了游戏引擎，最终决定，将这游戏做成web游戏、用`egret`进行游戏核心部分的开发、用vue来制作一些界面、用django制作游戏的后端，但用django来做`websocket`部分不太方便、就改用`node`来制作游戏的后端，由于在编写代码方面已经入门，这些框架很快就能学会。前后端都用typescripte来编写，这样就省去了一些重复性的代码。  

## 网站功能

- ### 地图

    > 游戏地图、瓦片地图，当中有：地形层、建筑层和单位层
    > ![]()

- ### 记录

    >无论是单人模式还是多人模式，所有战斗都会被记录下来并公开。这样玩家可以对经历过的战斗进行回放。这些记录也可以通过机械学习来训练电脑AI。

- ### 战役

    > 每个战役中包含许多章节，战役设计者可以给战役的选择界面提供封面、背景音乐、背景颜色

- ### 章节

    > 章节就是故事情节，章节内容的格式为`markdown`，支持HTML和思维导图graph，这意味着你可以在章节中提供视频内容。每个章节可以提供一张游戏地图，可以引用其他人制作的地图。章节中也可以提供背景音乐、页面背景颜色、背景图片。
  
- ### 感想

    > 一个类似于博客的东西，内容为markdown格式，支持HTML和思维导图graph，发布后所有人可见，内容不应违规、违法。
  
- ### 个人主页

    > 当中有邮箱、个性签名、最近的动态（recent）

- ### 动态

    > 地图、战役、感悟的创建与更新和记录的产生都会产生新的动态

---

## 技术细节

> 以下东西全由自己独立设计

### 代码结构概述（游戏部分）

> 为提高代码的维护性、可扩展性，游戏部分代码分为：数据层、地图渲染层、资源管理、通讯管理、AI层、交互界面层

- #### 数据层
  
    ```
    advancedwar_egret/src/Battle/MapData.ts  
    advancedwar_egret/src/Battle/MapDataFormat.ts
    ```  

    定义了数据格式，如地形、建筑、单位、地图等。一个单位包含血量、弹药量、油量等属性。  
    定义了许多算法。文件有个类MathMan，当中包含了许多算法，如：计算攻击范围、计算移动范围、计算最近的攻击目标、计算最短路径、计算能够到达目标点的所有路径...这些算法大多是在BFS算法、A*算法的基础改进的  
    管理游戏参数。一些游戏参数，如：单位移动距离、攻击范围。在在这些基础上还封装了函数用于两个单位之间攻击结果的计算

- #### 地图渲染层

    ```
    advancedwar_egret/src/Battle/MapDataUI.ts  
    ```

    定义了地形、建筑、单位等这些元素的动画模型  
    游戏地图的渲染，渲染的层级从下至上有：base层(背景)、地形层、建筑层、单位层、迷雾层、覆盖层。迷雾层主要在迷雾模式下发挥作用，目前还未提供该功能。覆盖层主要用来交互，比如：显示攻击范围、移动范围等。  
    文件有个类MathManUnit继承自数据层的MathMan，使用MathMan时需要从地图渲染层提取数据并稍加处理再调用MathMan封装的算法，其中“提取数据并稍加处理”这个过程就交由MathManUnit来处理

- #### 资源管理层

    ```
    advancedwar_egret/src/Battle/ResMng.ts  
    ```

    egret本身提供了良好的资源管理方案，这里所做的就是在egret的基础上将图片、音频、动态图等资源归类并提供函数给地图渲染层调用

- #### 通讯管理

    ```
    advancedwar_egret/src/Battle/netFormt.ts  
    advancedwar_egret/src/Battle/LocalServer.ts
    ```  

    定义了本地端与服务端通讯的数据格式
    文件中的类GameServer，复杂接受发送数据和断开后的重连。  
    GameServer接受到数据，直接将数据存放到地图渲染层的消息队列中，地图渲染层收到数据后，可能会先执行一段动画，最终将数据层的地图数据更改完毕。  
    用户交互产生的对地图渲染层的更改 需要先发送给服务器判断该更改是否有效，如果有效则将该更改广播给所有本地端。这样可以有效防止玩家作弊。

- ### AI层

    ```
    advancedwar_egret/src/Battle/AI.ts  
    ```

    为电脑玩家提供决策，目前AI内部的逻辑很简单、造兵 -> 寻找最近目标 -> 移动 -> 攻击

- #### 界面管理

    ```
    advancedwar_egret/src/Battle/BattleUI.ts  
    advancedwar_egret/src/Battle/EditorUI.ts  
    advancedwar_egret/src/Battle/ReviewUI.ts
    ```  

    界面管理 相当于对上述所有功能的封装再加上了一些UI，封装后的东西才是称得上产品  
    这里封装了三种界面：地图编辑界面、战斗界面、战斗回放界面  
    地图编辑界面：编辑地图  
    战斗界面：游戏的主要界面  
    回放界面：所有战斗都会产生记录，这界面用来回放游戏记录

## 资源版权

该网站目前不用于任何商业用途，目前该游戏中所有使用的的图片资源、音频资源多数来自互联网，如有侵权，请联系polar_bear2020@163.com

## something about

- 一套稳定的游戏需要有带有远见的策划（否则经常改来改去的），美术设计（能秀），代码架构（或者说程序员）

- 游戏虽然有趣，但本质是个能让人上瘾的东西，个人认为不是合理的职业
