import{d as q,f as m,g as T,z as C,F as j,l as W,h as N,w as v,j as H,t as R,I as ie,m as ce,_ as G,i as _,A as X,B as ee,C as ae,k as P,D as te,G as ve,H as _e,J as ye,r as S,c as x,K as De,L as ge,M as be,N as Ne,O as A,P as Ee,Q as ke,p as ue,q as de,v as we,R as Ce,S as me,b as Ie,u as Pe,W as le,T as U,o as Se,e as Te,U as se,E as f,V as Me,X as Oe,Y as Fe,Z as z,$ as Le,a0 as Be}from"./index-31ea285c.js";/* empty css               *//* empty css                        *//* empty css                     */import{S as Ue}from"./SplitPanelLayout-ade48211.js";/* empty css                *//* empty css                 *//* empty css               *//* empty css                  */import{E as u,M as oe,D as $,T as re,a as ne}from"./DirectroyTree-a29405c1.js";import{C as Ae}from"./el-tree-04aa848f.js";import{B as xe}from"./index-88ad1515.js";import{D as Re}from"./DialogBox-32bd50d6.js";import{c as b}from"./Cos-0001a053.js";import{m as Ve}from"./EchartsUtils-1234ec81.js";import"./install-7b032135.js";/* empty css                  *//* empty css                   *//* empty css                    */const Ye={class:"footer"},Ke=q({__name:"FooterStatusBar",props:{path:{},status:{}},emits:["command","path"],setup(I,{emit:L}){const M=L;return(E,V)=>{const k=ce;return m(),T("div",Ye,[C("div",null,[(m(!0),T(j,null,W(E.path,i=>(m(),N(k,{size:"small",key:i.value,onClick:o=>M("path",i.value)},{default:v(()=>[H(" / "+R(i.label),1)]),_:2},1032,["onClick"]))),128))]),C("div",null,[(m(!0),T(j,null,W(E.status,i=>(m(),N(ie,{key:i.value,width:15,height:15,type:i.icon,onClick:o=>M("command",i.value)},null,8,["type","onClick"]))),128))])])}}});const ze=G(Ke,[["__scopeId","data-v-3a7bf6ef"]]),pe=I=>(_e("data-v-ca3aaaf1"),I=I(),ye(),I),$e={class:"card-body"},He=pe(()=>C("span",null,"  创建",-1)),je=pe(()=>C("span",null,"  更新",-1)),We=q({__name:"CardFile",props:{data:{},selected:{type:Boolean},detailLevel:{},direction:{}},emits:["double-click","once-click"],setup(I,{emit:L}){const{data:M,selected:E,direction:V,detailLevel:k}=I,i=()=>V||"column",o=()=>k||0,O=L;return(g,p)=>{const c=ce,h=ve;return g.data.detail?(m(),N(h,{key:0,content:g.data.detail,enterable:!1,"show-after":200},{default:v(()=>[C("div",{onClick:p[0]||(p[0]=w=>O("once-click",g.data,w)),onDblclick:p[1]||(p[1]=w=>O("double-click",g.data,w)),class:ae(g.selected?"card-container-hover":"card-container"),style:te({flexDirection:i(),maxWidth:i()=="row"?"100%":void 0,justifyContent:o()==0?"center":"space-between"})},[C("div",$e,[_(ie,{type:g.data.isDir?X(ee).FOLDER:X(ee).FILE,class:ae(i()=="row"?"card-img-small":"card-img")},null,8,["type","class"]),i()=="row"?(m(),N(c,{key:0},{default:v(()=>[H("  文件名sldfkjdfj")]),_:1})):P("",!0)]),i()=="column"?(m(),N(c,{key:0,class:"card-body"},{default:v(()=>[H(R(g.data.fileName),1)]),_:1})):P("",!0),o()>0?(m(),N(c,{key:1},{default:v(()=>[H(R(g.data.fileSize)+"k",1)]),_:1})):P("",!0),o()>0?(m(),N(c,{key:2},{default:v(()=>[C("time",null,R(g.data.createTime),1),He]),_:1})):P("",!0),o()>0?(m(),N(c,{key:3},{default:v(()=>[C("time",null,R(g.data.updateTime),1),je]),_:1})):P("",!0),o()>1?(m(),N(c,{key:4},{default:v(()=>[H(R(g.data.detail),1)]),_:1})):P("",!0)],38)]),_:1},8,["content"])):P("",!0)}}});const Xe=G(We,[["__scopeId","data-v-ca3aaaf1"]]),qe={class:"search"},Ge={class:"list"},Je=q({__name:"FileBrowserView",props:{data:{},searchData:{},contentMenuData:{},height:{},width:{}},emits:["command"],setup(I,{emit:L}){const{data:M,searchData:E,contentMenuData:V,height:k,width:i}=I,o=L,O=S(E.searchType?E.searchType:E.searchTypes[0].value),g=S(E.orderKeys?E.orderKeys[0].value:void 0),p=x({}),c=(s,a,t=!0)=>{let r;return t?r=A.filter(s,F=>{let y=A.clone(F);return y.children=y.children?c(y.children,a,t):[],y.selected=p[y.id],!a||y.children.length||y.label.includes(a)}):r=A.filter(s,F=>{let y=A.clone(F);return y.children=y.children?c(y.children,a,t):[],y.selected=p[y.id],!a||y.children.length&&y.tags&&A.find(y.tags,Z=>Z.includes(a))}),r},h=S(null),w=S(!1),Y=S(""),J=De(()=>c(M,Y.value,O.value=="kw")),K=s=>{s.key==="Escape"?w.value=!1:s.key.length==1&&(w.value=!0,h.value&&h.value.focus())},Q=s=>{s.preventDefault(),s.stopPropagation(),B.value=!0;let a=s.clientX,t=s.clientY;l.x=a-5,l.y=t-5},B=S(!1),l=x({x:0,y:0}),e=s=>{B.value=!1,o("command",s,A.filter(M,a=>p[a.id]))},n=(s,a)=>{a.ctrlKey?p[s.id]=!p[s.id]:(Object.keys(p).forEach(t=>{p[t]=void 0}),p[s.id]=!0,o("command",u.NODE_CLICK,[s]))},d=(s,a)=>{a.ctrlKey?p[s.id]=!p[s.id]:(Object.keys(p).forEach(t=>{p[t]=void 0}),p[s.id]=!0),o("command",u.NODE_DOUBLE_CLICK,[s])};return(s,a)=>{const t=Ee,r=ke,F=ue,y=de,Z=we,he=Ce,fe=me;return m(),T("div",{class:"container",style:te({height:s.height,width:s.width}),onKeydown:K,onContextmenu:Q,tabindex:"0"},[C("div",qe,[w.value?(m(),N(Z,{key:0,ref_key:"searchBarRef",ref:h,modelValue:Y.value,"onUpdate:modelValue":a[2]||(a[2]=D=>Y.value=D),placeholder:"Filter keyword"},ge({prepend:v(()=>[_(r,{modelValue:O.value,"onUpdate:modelValue":a[0]||(a[0]=D=>O.value=D),placeholder:"Select",style:{width:"80px"}},{default:v(()=>[(m(!0),T(j,null,W(s.searchData.searchTypes,D=>(m(),N(t,{label:D.label,value:D.value,key:D.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:2},[s.searchData.orderKeys?{name:"append",fn:v(()=>[_(y,null,{default:v(()=>[_(F,{span:12},{default:v(()=>[_(r,{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=D=>g.value=D),placeholder:"Select",style:{width:"80px"}},{default:v(()=>[(m(!0),T(j,null,W(s.searchData.orderKeys,D=>(m(),N(t,{label:D.label,value:D.value,key:D.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["modelValue"])):P("",!0)]),be(_(Ae,{"content-menu-data":s.contentMenuData,onCommand:e,style:te({left:l.x+"px",top:l.y+"px"}),onMouseleave:a[3]||(a[3]=D=>B.value=!1)},null,8,["content-menu-data","style"]),[[Ne,B.value]]),_(fe,null,{default:v(()=>[C("div",Ge,[(m(!0),T(j,null,W(J.value,D=>(m(),T("div",{key:D.id},[_(Xe,{onOnceClick:n,onDoubleClick:d,data:D,selected:p[D.id]},null,8,["data","selected"])]))),128))]),_(he)]),_:1})],36)}}});const Qe=G(Je,[["__scopeId","data-v-0813c87e"]]),Ze={class:"container"},et=q({__name:"CosBrowserPage",setup(I){const L=Ie(),M=Pe(),E=(l,e)=>{console.log(l,e);const n=new re;n.isRoot=!0;const d=[],s=new ne;return s.childrenType="array",s.parentIdKey="parentId",s.nameKey="fileName",e.forEach(a=>{const t=new $;t.createTime=z(a.createTime).format("YYYY-MM-DD HH:mm:ss"),t.detail=a.fullDirectoryName,t.isDir=!0,t.fileName=a.name,t.label=a.name,t.parentId=a.parentId,t.tags=[],t.id=a.id,t.fullPath=(a.fullDirectoryName=="/"?"/":a.fullDirectoryName)+a.name+"/",d.push(t)}),l.forEach(a=>{const t=new $;t.createTime=z(a.createTime).format("YYYY-MM-DD HH:mm:ss"),t.detail=a.fullDirectoryName,t.fileSize=a.fileSize,t.isDir=!1,t.fileName=a.fileName,t.label=a.fileName,t.parentId=a.directoryId,t.tags=[],t.id=a.id,t.fullPath=(a.fullDirectoryName=="/"?"/":a.fullDirectoryName)+a.fileName,d.push(t)}),console.log("topNodes",d),d},V=(l,e)=>{const n={},d=new re;d.isRoot=!0;const s=new ne;s.childrenType="array",s.parentIdKey="parentId",s.nameKey="fileName",e.forEach(t=>{const r=new $;r.createTime=z(t.createTime).format("YYYY-MM-DD HH:mm:ss"),r.detail=t.fullDirectoryName,r.isDir=!0,r.fileName=t.name,r.label=t.name,r.parentId=t.parentId,r.tags=[],r.id=t.id,r.fullPath=(t.fullDirectoryName=="/"?"/":t.fullDirectoryName)+t.name+"/",n[r.id]=r});const a=s.makeRootByParentId(A.values(n));return l.forEach(t=>{var F;const r=new $;r.createTime=z(t.createTime).format("YYYY-MM-DD HH:mm:ss"),r.detail=t.fullDirectoryName,r.fileSize=t.fileSize,r.isDir=!1,r.fileName=t.fileName,r.label=t.fileName,r.parentId=t.directoryId,r.tags=[],r.id=t.id,r.fullPath=(t.fullDirectoryName=="/"?"/":t.fullDirectoryName)+t.fileName,t.directoryId?n[t.directoryId]&&((F=n[t.directoryId].children)==null||F.push(r)):a.push(r)}),a},k=x({fileMetaId:"",option:{},statistics:new le}),i=(l="/")=>{console.log(`enter path ${l}`),b.listFilesAndDirectories(l).then(e=>{var n;w.splice(0,w.length,...E(e.files,e.directories)),console.log("refresh",e,l),c.value={...c.value,id:((n=e.dirInfo)==null?void 0:n.id)??null,fullPath:l},K.path=oe.decomposePath(l).map(d=>({value:d.substring(0,d.lastIndexOf("/")+1),label:d.substring(d.lastIndexOf("/")+1)})),console.log("d_path",oe.decomposePath(l).map(d=>({value:d.substring(0,d.lastIndexOf("/")+1),label:d.substring(d.lastIndexOf("/")+1)})))}),h.value=[]},o=x({title:"新建文件",visible:!1,value:"",type:U.INPUT,currentStatus:u.NONE}),O=(l,e)=>{switch(console.log("browser",l,e),o.currentStatus=l,h.value=e,l){case u.UPLOAD:o.currentStatus=l,o.title="上传文件",o.type=U.UPLOAD,o.visible=!0;break;case u.RE_UPLOAD:o.currentStatus=l,o.title="上传文件",o.type=U.UPLOAD,o.visible=!0;break;case u.ADD_FOLDER:o.title="新建文件夹",o.type=U.INPUT,o.visible=!0;break;case u.DELETE:if(e.length==0)return;o.title="删除文件",o.type=U.CONFIRM,o.visible=!0;break;case u.RENAME:if(e.length!=1)return;o.title="rename "+e[0].fileName,o.type=U.INPUT,o.visible=!0;break;case u.NODE_CLICK:if(e.length!=1&&e[0].isDir)return;b.getFileInfo(void 0,e[0].id).then(n=>{k.statistics=(n==null?void 0:n.worksStatistics)??new le,k.fileMetaId=n==null?void 0:n.id,Oe.getHistoryWorksStatistics(n.id,Fe.COS).then(d=>{k.option=Ve("近期数据",{访问量:d.map(s=>({date:z(s.historyCreateTime).format("yyyy-MM-DD HH"),value:s.viewNum}))})})});break;case u.NODE_DOUBLE_CLICK:if(e.length!=1||!e[0].isDir)return;i(e[0].fullPath);break;case u.MOVE:if(e.length!=1)return;console.log("move",e[0]),o.title=`将 ${e[0].fullPath} 移动到`,b.listAllDirectory("/").then(n=>{o.value=V([],n.directories),o.type=U.SELECT_TREE,o.visible=!0}).catch(n=>{f.error(n.message)});break;case u.COPY_LINK:{if(e.length==0||e[0].isDir){f.error("请选择文件");return}Me(se.serviceBaseUrl+"/cos/"+L.userInfo.cosUsername+e[0].fullPath);break}}},g=l=>{switch(console.log("config",o.currentStatus,l,c),o.currentStatus){case u.UPLOAD:console.log("add file",l,c,h.value);break;case u.ADD_FOLDER:console.log("add folder",l),b.createDirectory(c.value.id??null,l).then(e=>{f.success("创建成功"),i(c.value.fullPath)}).catch(e=>{f.error(e.message)});break;case u.DELETE:console.log("delete",l),h.value[0].isDir?b.deleteDirectory(h.value[0].id).then(e=>{f.success("删除成功"),i(c.value.fullPath)}).catch(e=>{f.error(e.message)}):b.deleteFile(h.value[0].id).then(e=>{f.success("删除成功"),i(c.value.fullPath)}).catch(e=>{f.error(e.message)});break;case u.RENAME:console.log("rename",l),h.value[0].isDir?b.moveDirectory(h.value[0].id,null,l).then(e=>{f.success("重命名成功"),i(c.value.fullPath)}).catch(e=>{f.error(e.message)}):b.moveFile(h.value[0].id,null,l).then(e=>{f.success("重命名成功"),i(c.value.fullPath)}).catch(e=>{f.error(e.message)});break;case u.MOVE:h.value[0].isDir?b.moveDirectory(h.value[0].id,l,null).then(e=>{f.success("移动成功"),i(c.value.fullPath)}).catch(e=>{f.error(e.message)}):b.moveFile(h.value[0].id,l,null).then(e=>{f.success("移动成功"),i(c.value.fullPath)}).catch(e=>{f.error(e.message)});break}},p=l=>{switch(console.log("upload",l,c.value),o.currentStatus){case u.UPLOAD:b.createFileMeta(c.value.id,void 0,void 0,l.name,void 0,l.size).then(e=>{if(console.log("createFileMeta",e),!e)throw new Error("create file meta failed");b.uploadFile(e,l.raw).then(n=>{console.log("createFileMeta-result",n),f.success("上传成功"),i(c.value.fullPath)}).catch(n=>{f.error(n.message)})}).catch(e=>{f.error(e.message)});break;case u.RE_UPLOAD:{if(h.value.length!=1)return;b.uploadFile(h.value[0].id,l.raw).then(e=>{console.log("createFileMeta-result",e),f.success("上传成功"),i(c.value.fullPath)}).catch(e=>{f.error(e.message)})}}},c=S(new $),h=S([]),w=x([]),Y=S([{cmd:u.UPLOAD,icoName:"el-icon-delete",label:"上传文件"},{cmd:u.RE_UPLOAD,icoName:"el-icon-delete",label:"重传"},{cmd:u.ADD_FOLDER,icoName:"el-icon-delete",label:"新建文件夹"},{cmd:u.RENAME,icoName:"el-icon-plus",label:"重命名"},{cmd:u.DELETE,icoName:"el-icon-plus",label:"删除"},{cmd:u.MOVE,icoName:"el-icon-plus",label:"移动到"},{cmd:u.COPY_LINK,icoName:"el-icon-plus",label:"复制链接"}]),J=x({searchType:"kw",searchTypes:[{label:"关键字",value:"kw"},{label:"tag",value:"tag"}],tags:["ag1","tag2"],orderKeys:[{label:"名称",value:"fileName"},{label:"创建时间",value:"createTime"},{label:"更新时间",value:"updateTime"}]}),K=x({path:[{value:"/",label:"根目录"}],status:[{icon:ee.FILE,value:"111"}]}),Q=l=>{let e=l.substring(0,l.lastIndexOf("/"));e.length<=1?e="/":e+="/",console.log(l,e,"status value"),i(e)},B=()=>{M.switchPage([])};return Se(()=>{B()}),Te(()=>{i(),B()}),(l,e)=>{const n=Le,d=ue,s=Be,a=de,t=me;return m(),T("div",Ze,[_(Ue,{"original-fist-size":"75%","original-second-size":"25%"},{first:v(()=>[_(Qe,{"content-menu-data":Y.value,data:w,"search-data":J,onCommand:O},null,8,["content-menu-data","data","search-data"])]),second:v(()=>[h.value.length==1?(m(),N(t,{key:0},{default:v(()=>[_(a,{align:"middle"},{default:v(()=>[_(d,{span:8},{default:v(()=>[_(n,{style:{"text-align":"center"},title:"访问量",value:k.statistics.viewNum},null,8,["value"])]),_:1}),_(d,{span:16},{default:v(()=>[_(s,{style:{width:"100px",height:"100px"},src:X(se).serviceBaseUrl+"/cos-downland/"+k.fileMetaId,fit:"cover"},null,8,["src"])]),_:1})]),_:1}),_(X(xe),{class:"chart",option:k.option,autoresize:""},null,8,["option"])]),_:1})):P("",!0)]),_:1}),_(Re,{visible:o.visible,"onUpdate:visible":e[0]||(e[0]=r=>o.visible=r),value:o.value,type:o.type,title:o.title,onConfirm:g,"before-upload":p},null,8,["visible","value","type","title"]),_(ze,{path:K.path,status:K.status,onPath:Q},null,8,["path","status"])])}}});const gt=G(et,[["__scopeId","data-v-30b1d601"]]);export{gt as default};
