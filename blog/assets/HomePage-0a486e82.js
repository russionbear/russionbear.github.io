var O=Object.defineProperty;var b=(s,t,u)=>t in s?O(s,t,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[t]=u;var i=(s,t,u)=>(b(s,typeof t!="symbol"?t+"":t,u),u);import{y as H,c as M,X as I,a5 as n,O as o,a6 as T,d as G,u as A,a as L,K as E,o as W,e as V,a7 as K,a2 as z,f as k,g as B,z as h,i as c,A as y,w as S,F as $,l as F,h as X,j as w,a0 as Y,a8 as j,a9 as q,aa as J,p as Q,q as Z,m as ee,_ as te}from"./index-31ea285c.js";/* empty css                *//* empty css               *//* empty css                *//* empty css                        */import{B as U}from"./index-88ad1515.js";import{m as P}from"./EchartsUtils-1234ec81.js";import{o as se}from"./DomUtils-6f7af2dc.js";import{S as oe}from"./SearchBar-ec4e9ecf.js";import"./install-7b032135.js";/* empty css                 */class ae{constructor(){i(this,"refreshTime",new Date);i(this,"introduction","");i(this,"links",[]);i(this,"userIntroduction","sdsdfsd");i(this,"worksIntroduction","sdfsdfsdf");i(this,"registerUserNum",[]);i(this,"activeUserNum",[]);i(this,"publishedWorksNum",[]);i(this,"publishedGossipsNum",[]);i(this,"registerMailTypeDistribution",[]);i(this,"accessedPageCategoryDistribution",[]);i(this,"accessedIpDistribution",[])}}const re=H("homeStore",()=>{const s=M(new ae),t=(m,v)=>{let d=m;for(const _ in v)d=d.replace(`{${_}}`,v[_]);return d};return{homePageData:s,load:async()=>{const m=await I.getSystemStatistics("HOME"),v=await I.getHistorySystemStatistics("HOME",n.ACTIVE_USER_NUM),d=await I.getHistorySystemStatistics("HOME",n.REGISTER_USER_NUM),_=await I.getHistorySystemStatistics("HOME",n.PUBLISHED_WORKS_NUM),p=await I.getHistorySystemStatistics("HOME",n.PUBLISHED_GOSSIP_NUM);[v,d,p,_].forEach(e=>{e.forEach(a=>{a.insertTime=a.historyCreateTime})}),m.push(...v,...d,...p,..._);const r=o.groupBy(m,"type");s.refreshTime=new Date;const l=o.chain(r[n.INTRODUCTION]).orderBy("insertTime","desc").take(1).value()[0];l&&(s.introduction=t(l.content,l.context),s.links=o.isString(l.context.links)?JSON.parse(l.context.links):l.context.links);const g=o.chain(r[n.USER_INTRODUCTION]).orderBy("insertTime","desc").take(1).value()[0];g&&(s.userIntroduction=t(g.content,g.context));const f=o.chain(r[n.WORKS_INTRODUCTION]).orderBy("insertTime","desc").take(1).value()[0];f&&(s.worksIntroduction=t(f.content,f.context)),s.registerUserNum=o.chain(r[n.REGISTER_USER_NUM]).groupBy(e=>T(e.insertTime).format("yyyy-MM-DD HH")).map((e,a)=>({date:a,value:o.sumBy(e,"value")})).value(),s.activeUserNum=o.chain(r[n.ACTIVE_USER_NUM]).groupBy(e=>T(e.insertTime).format("yyyy-MM-DD HH")).map((e,a)=>({date:a,value:o.sumBy(e,"value")})).value(),s.publishedWorksNum=o.chain(r[n.PUBLISHED_WORKS_NUM]).groupBy(e=>T(e.insertTime).format("yyyy-MM-DD HH")).map((e,a)=>({date:a,value:o.sumBy(e,"value")})).value(),s.publishedGossipsNum=o.chain(r[n.PUBLISHED_GOSSIP_NUM]).groupBy(e=>T(e.insertTime).format("yyyy-MM-DD HH")).map((e,a)=>({date:a,value:o.sumBy(e,"value")})).value(),s.registerMailTypeDistribution=o.chain(r[n.REGISTER_MAIL_TYPE_DISTRIBUTION]).groupBy(e=>e.key).map((e,a)=>({name:a,value:o.sumBy(e,"value")})).value(),s.accessedPageCategoryDistribution=o.chain(r[n.ACCESSED_PAGE_CATEGORY_DISTRIBUTION]).groupBy(e=>e.key).map((e,a)=>({name:a,value:o.sumBy(e,"value")})).value(),s.accessedIpDistribution=o.chain(r[n.ACCESSED_IP_DISTRIBUTION]).groupBy(e=>e.key).map((e,a)=>({name:a,value:o.sumBy(e,"value")})).value()},unload:()=>{}}}),ne={class:"container"},ie={class:"search-row row"},ce={class:"row"},le={class:"intro-text"},ue={class:"row"},me={class:"intro-text"},de={class:"row",style:{"margin-bottom":"50px"}},_e={class:"intro-text"},pe={class:"footer-content"},he=G({__name:"HomePage",setup(s){const t=re(),u=A(),N=L(),m=(p,r,l=10)=>{const g=o.chain(r).sortBy("value").reverse().take(l).value();return{title:{text:p,left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},series:[{name:p,type:"pie",radius:"50%",data:g,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}},v=E(()=>P("作品和评论",{作品数:t.homePageData.publishedWorksNum,评论数:t.homePageData.publishedGossipsNum})),d=E(()=>P("活跃用户",{活跃用户:t.homePageData.activeUserNum,已注册用户:t.homePageData.registerUserNum}));E(()=>m("邮箱类型",t.homePageData.registerMailTypeDistribution)),E(()=>m("页面访问分布",t.homePageData.accessedPageCategoryDistribution)),E(()=>m("ip分布",t.homePageData.accessedIpDistribution));const _=()=>{u.switchPage([])};return W(()=>{_()}),V(()=>{_(),t.load().then(p=>p)}),K(()=>{t.unload()}),(p,r)=>{const l=Y,g=j,f=q,e=z("v-md-preview"),a=J,x=Q,R=Z,C=ee;return k(),B("div",ne,[h("div",ie,[c(oe,{onClick:r[0]||(r[0]=D=>y(N).push("/search"))})]),h("div",ce,[c(f,{interval:5e3,height:"500px",style:{"max-width":"800px"}},{default:S(()=>[(k(!0),B($,null,F(y(t).homePageData.links,D=>(k(),X(g,{key:D.linkTo},{default:S(()=>[c(l,{fit:"fill",src:D.cover,alt:D.name,onClick:ye=>y(se)(D.linkTo,!0)},null,8,["src","alt","onClick"])]),_:2},1024))),128))]),_:1}),h("div",le,[c(e,{text:y(t).homePageData.introduction},null,8,["text"])])]),h("div",ue,[h("div",me,[c(e,{text:y(t).homePageData.userIntroduction},null,8,["text"])]),c(y(U),{class:"chart",option:v.value,autoresize:""},null,8,["option"])]),h("div",de,[c(y(U),{class:"chart",option:d.value,autoresize:""},null,8,["option"]),h("div",_e,[c(e,{text:y(t).homePageData.worksIntroduction},null,8,["text"])])]),h("div",pe,[c(R,null,{default:S(()=>[c(x,null,{default:S(()=>[c(a,{href:"https://github.com/russionbear",target:"_blank"},{default:S(()=>[w("Github")]),_:1})]),_:1})]),_:1}),c(C,null,{default:S(()=>[w("copyright@russionbear")]),_:1})])])}}});const Ue=te(he,[["__scopeId","data-v-4ae7fd56"]]);export{Ue as default};
