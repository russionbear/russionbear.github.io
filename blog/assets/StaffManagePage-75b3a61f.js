import{d as A,c as S,r as i,ar as V,e as C,a6 as u,f as U,g as R,i as a,w as n,j as k,z,E as h,P as x,Q as Y,p as I,s as P,v as B,q as K,x as N,_ as F}from"./index-31ea285c.js";/* empty css                  *//* empty css                   *//* empty css               *//* empty css                 *//* empty css               *//* empty css                  */import{G as H}from"./GeneralTable-35001312.js";import{e as c}from"./Examine-bbff49eb.js";/* empty css                    */const $={class:"dialog-footer"},G=A({__name:"StaffManagePage",setup(O){const l=S({tableKey:Math.random().toString(),total:0,page:1,pageSize:20}),m=i(""),g=i("ALL"),d=i(V.ALL),w=i([{label:"id",prop:"id",width:"120",fixed:!0},{label:"邮箱",prop:"email",width:"120"},{label:"用户名",prop:"username",width:"120"},{label:"解冻时间",prop:"unlockTime",width:"120"},{label:"用户权限",prop:"role",width:"120"},{label:"cos root",prop:"cosUsername"},{label:"创建时间",prop:"createTime",width:"120"},{label:"Operations",prop:"operations",width:"160",fixed:"right",operations:[{label:"冻号",cmd:"lock"},{label:"解冻",cmd:"unlock"},{label:"更改权限",cmd:"role"}]}]),f=i([]),s=S({showRoleDialog:!1,role:V.ALL,userId:null}),E=()=>{c.setUserRole(s.userId,s.role).then(r=>{h.success("更改权限成功"),s.showRoleDialog=!1,p(l.page)})},D=(r,e)=>{switch(r){case"lock":c.setUnlockTime(e.id,u().add(7,"days").toDate()).then(o=>{h.success("冻号成功"),p(l.page)});break;case"unlock":c.setUnlockTime(e.id,u().subtract(1,"days").toDate()).then(o=>{h.success("解冻成功"),p(l.page)});break;case"role":s.showRoleDialog=!0,s.role=e.role,s.userId=e.id;break}},p=r=>{console.log("mounted",l.page),c.searchUserList(m.value,y(),d.value=="ALL"?void 0:d.value,l.page-1,l.pageSize).then(e=>{e.content.forEach(o=>{o.unlockTime=u(o.unlockTime).isAfter(u())?u(o.unlockTime).format("YYYY-MM-DD HH:mm:ss"):"未冻结"}),f.value=e.content,l.total=e.totalElements,l.page=e.number+1,l.tableKey=Math.random().toString()})},y=()=>{switch(g.value){case"blocked":return!0;case"unblocked":return!1;default:return}};return C(()=>{c.searchUserList(m.value,y(),d.value=="ALL"?void 0:d.value,l.page-1,l.pageSize).then(r=>{r.content.forEach(e=>{e.unlockTime=u(e.unlockTime).isAfter(u())?u(e.unlockTime).format("YYYY-MM-DD HH:mm:ss"):"未冻结"}),f.value=r.content,l.total=r.totalElements,l.page=r.number+1,l.tableKey=Math.random().toString()})}),(r,e)=>{const o=x,b=Y,v=I,_=P,L=B,M=K,T=N;return U(),R("div",null,[a(M,{class:"staff-mng-header"},{default:n(()=>[a(v,{span:6},{default:n(()=>[a(b,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),placeholder:"请选择用户权限",size:"large",onChange:e[1]||(e[1]=t=>p(l.page))},{default:n(()=>[a(o,{label:"全部",value:"ALL"}),a(o,{label:"普通用户",value:"USER"}),a(o,{label:"员工",value:"STAFF"}),a(o,{label:"管理员",value:"ADMIN"})]),_:1},8,["modelValue"])]),_:1}),a(v,{span:6},{default:n(()=>[a(b,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=t=>g.value=t),placeholder:"是否冻结",size:"large",onChange:e[3]||(e[3]=t=>p(l.page))},{default:n(()=>[a(o,{label:"全部",value:"ALL"}),a(o,{label:"冻结",value:"blocked"}),a(o,{label:"未冻结",value:"unblocked"})]),_:1},8,["modelValue"])]),_:1}),a(v,{span:6},{default:n(()=>[a(L,{size:"large",modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=t=>m.value=t),placeholder:"请输入用户名或邮箱"},{append:n(()=>[a(_,{type:"primary",onClick:e[4]||(e[4]=t=>p(l.page))},{default:n(()=>[k("Search")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(H,{"table-key":l.tableKey,columns:w.value,"table-data":f.value,total:l.total,"page-size":l.pageSize,page:l.page,onCommand:D,onPageChange:p},null,8,["table-key","columns","table-data","total","page-size","page"]),a(T,{modelValue:s.showRoleDialog,"onUpdate:modelValue":e[8]||(e[8]=t=>s.showRoleDialog=t),title:"更改用户权限",width:"500","align-center":""},{footer:n(()=>[z("div",$,[a(_,{onClick:e[7]||(e[7]=t=>s.showRoleDialog=!1)},{default:n(()=>[k("Cancel")]),_:1}),a(_,{type:"primary",onClick:E},{default:n(()=>[k(" Confirm ")]),_:1})])]),default:n(()=>[a(b,{modelValue:s.role,"onUpdate:modelValue":e[6]||(e[6]=t=>s.role=t),placeholder:"请选择用户权限",size:"large"},{default:n(()=>[a(o,{label:"普通用户",value:"USER"}),a(o,{label:"员工",value:"STAFF"}),a(o,{label:"管理员",value:"ADMIN"})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])])}}});const oe=F(G,[["__scopeId","data-v-46a8499c"]]);export{oe as default};
