import{D as G,N as S,G as F,C as L}from"./backend-1e23b029.js";import{M as k}from"./MyLinkTo-0f6fd3a0.js";import{d as V,e as v,o as h,h as w,w as p,f as g,t as b,i as A,v as B,r,l as R,b as i,a as T,g as M,F as $,s as U,k as E}from"./index-095ee474.js";import{_ as I,D as N,N as q,R as j,G as D,C}from"./localAxios-f87130d1.js";const z={class:"card-container"},H={class:"card-username"},J={class:"card-msg",text:""},K=V({__name:"DiscussInfo",props:{discuss:null},setup(x){return(n,a)=>{const e=v("el-card");return h(),w(e,{class:"box-card",shadow:"hover"},{default:p(()=>[g("div",z,[g("span",H,b(x.discuss.username),1),A("ï¼š"),g("span",J,b(x.discuss.value),1)])]),_:1})}}});const Q=I(K,[["__scopeId","data-v-89ff4d40"]]),W={class:"container"},X=V({__name:"DiscussDialog",props:{userid:{default:void 0}},setup(x,{expose:n}){const a=B(),e=r(!1),u=r(""),c=r(""),l=r(""),f=r(!1),d=R([...Array(0).keys()].map(t=>{const s=new G;return s.username="username",s.createTime=new Date().getDate(),s.value="content",s}));n({visible:f,refresh:(t,s)=>{u.value=t,c.value=s,N.getAll(s).then(_=>{d.splice(0,d.length),d.push(..._.data)})}});const y=()=>{if(a.token==null||l.value.length==0||e.value)return;const t=new G;t.value=l.value,t.createTime=new Date().getDate(),t.userid=a.userid,t.noteid=c.value,t.username=a.username,l.value="",N.insertOne(t).then(s=>{s.data!="0"&&d.push(t)}).finally(()=>{e.value=!1})};return(t,s)=>{const _=v("el-input"),o=v("el-scrollbar"),P=v("el-dialog");return h(),w(P,{modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=m=>f.value=m),"show-close":!1,width:"60%"},{header:p(()=>[A(b(u.value),1)]),footer:p(()=>[i(_,{modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=m=>l.value=m),placeholder:"discuss",clearable:"",onChange:y},null,8,["modelValue"])]),default:p(()=>[i(o,{height:"480px"},{default:p(()=>[g("div",W,[(h(!0),T($,null,M(d,m=>(h(),w(Q,{discuss:m},null,8,["discuss"]))),256))])]),_:1})]),_:1},8,["modelValue"])}}});const Y=I(X,[["__scopeId","data-v-0fab8592"]]),Z={class:"container"},ee=V({__name:"ArticleView",setup(x){const n=B(),a=E(),e=R(new S),u=r(!1),c=r(!1),l=r(null),f=()=>{if(n.token!=null)if(u.value===!1){let t=new F;t.noteid=e.noteid,t.userid=n.userid,D.insertOne(t).then(s=>{s.data=="1"&&(e.goods++,u.value=!0)})}else D.deleteOne(e.noteid,n.userid).then(t=>{t.data=="1"&&(e.goods--,u.value=!1)})},d=()=>{if(n.token!=null)if(c.value==!1){let t=new L;t.noteid=e.noteid,t.userid=n.userid,console.log("insert"),C.insertOne(t).then(s=>{console.log(s),s.data=="1"&&(e.collections++,c.value=!0)})}else C.deleteOne(e.noteid,n.userid).then(t=>{t.data=="1"&&(e.collections--,c.value=!1)})},O=()=>{l.value!=null&&(l.value.visible=!0)},y=()=>{a.push(`/visit/selfPage?/${e.username}`)};return U(()=>{e.content="> some thing may error",e.goods=0,e.collections=0;let t=a.currentRoute.value.fullPath.indexOf("?");if(t===-1)return;let s=a.currentRoute.value.fullPath.substring(t+2).split("/");q.getOneByFull(s[0],s[1],s[2]).then(_=>{for(let o in e)e[o]=_.data[o];j.findTextByFullName(s[0],s[1],s[2],"__content__").then(o=>{e.content=o.data}),l.value.refresh(e.notename,e.noteid),n.token!=null&&(D.getOne(e.noteid,n.userid).then(o=>{console.log(o.data),o.data=="1"&&(u.value=!0)}),C.getOne(n.userid,e.noteid).then(o=>{console.log(o),o.data=="1"&&(c.value=!0)}))})}),(t,s)=>{const _=v("v-md-preview");return h(),T($,null,[g("div",Z,[i(_,{text:e.content},null,8,["text"])]),i(Y,{ref_key:"discuss_dialog_ref",ref:l},null,512),i(k,{text:"PAGE","link-type":"event",bottom:380,onClick:y}),i(k,{text:"GOSSIP","link-type":"event",bottom:320,onClick:O}),i(k,{text:`GOOD ${e.goods}`,"link-type":"event",bottom:260,onClick:f},null,8,["text"]),i(k,{text:"STAR "+e.collections,"link-type":"event",bottom:200,onClick:d},null,8,["text"])],64)}}});const le=I(ee,[["__scopeId","data-v-b83a9c42"]]);export{le as default};
