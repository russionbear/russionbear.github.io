import{S as oe,N as Y,R as ae,E as se}from"./backend-1e23b029.js";import{d as O,v as H,r as _,k as J,s as Z,e as c,o as y,h as S,w as r,b as s,f as I,a as R,g as B,u as N,F as A,y as M,p as K,q as Q,i as U,t as j,l as T,z as re,A as ue,n as de}from"./index-1956f8a2.js";import{M as G}from"./MyLinkTo-cdd27145.js";import{N as ie}from"./NoteInfo-e552c350.js";import{S as W,_ as L,N as z,R as E,E as _e}from"./localAxios-b17f8d20.js";import{S as ce}from"./StorageInfo-a41ad109.js";import{a as ee,V as ne}from"./dataFormat-beb63422.js";import{i as me}from"./generalConfig-4c4c12a0.js";import{E as pe}from"./EditModelInfo-208274f1.js";const fe=f=>(K("data-v-b813c507"),f=f(),Q(),f),ve={class:"container"},ge=fe(()=>I("span",null,"rename",-1)),he=O({__name:"StorageListDialog",setup(f,{expose:C}){const a=H(),t=_(!1),l=J(),i=_(!1),m=_(""),d=_("");C({visible:t}),Z(()=>{});const b=u=>{l.push(`/visit/noteList?/${u.username}/${u.bookname}`)},h=u=>{W.deleteOne(u.userid,u.bookname).then(v=>{if(v.data=="1"){for(let n=0;n<a.storages.length;n++)if(a.storages[n].bookname==u.bookname){a.storages.splice(n,1),a.current_storage==u.bookname&&(a.current_storage="");break}}})},x=u=>{i.value=!0,d.value=u.bookname,m.value=u.bookname},k=()=>{if(!(m.value.replaceAll(" ","").length==0||m.value==d.value)){for(let u of a.storages)if(u.bookname==m.value){M({type:"info",message:" name repeat"});return}W.rename(a.userid,d.value,m.value).then(u=>{if(u.data=="1"){for(let v of a.storages)if(v.bookname==d.value){v.bookname=m.value,a.current_storage==d.value&&(a.current_storage=m.value);break}i.value=!1,M({type:"success"})}})}},p=_(""),V=()=>{if(p.value.replaceAll(" ","").length==0||a.storages.findIndex(v=>v.bookname==p.value)!=-1)return;let u=new oe;u.userid=a.userid,u.username=a.username,u.bookname=p.value,W.insertOne(u).then(v=>{v.data=="1"&&a.storages.splice(0,0,u)})};return(u,v)=>{const n=c("el-input"),e=c("el-scrollbar"),o=c("el-space"),g=c("el-dialog");return y(),S(g,{modelValue:t.value,"onUpdate:modelValue":v[3]||(v[3]=w=>t.value=w),"show-close":!1},{footer:r(()=>[s(n,{modelValue:p.value,"onUpdate:modelValue":v[0]||(v[0]=w=>p.value=w),placeholder:"create storage",clearable:"",onChange:V},null,8,["modelValue"])]),default:r(()=>[s(e,{height:"500px"},{default:r(()=>[I("div",ve,[(y(!0),R(A,null,B(N(a).storages,w=>(y(),S(ce,{onEnter:b,onDelete:h,onEdit:x,"storage-info":w,"can-edit":!0},null,8,["storage-info"]))),256))])]),_:1}),s(g,{modelValue:i.value,"onUpdate:modelValue":v[2]||(v[2]=w=>i.value=w),"align-center":""},{default:r(()=>[s(o,{wrap:""},{default:r(()=>[ge,s(n,{modelValue:m.value,"onUpdate:modelValue":v[1]||(v[1]=w=>m.value=w),onChange:k},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}});const be=L(he,[["__scopeId","data-v-b813c507"]]),Ve=f=>(K("data-v-c59358e6"),f=f(),Q(),f),we=Ve(()=>I("span",null,"rename",-1)),ye={class:"container"},ke=O({__name:"NoteListDialog",setup(f,{expose:C}){const a=_(!1),t=H(),l=_(""),i=_(!1),m=_(null),d=e=>{t.current_storage=e,t.notelist.splice(0,t.notelist.length),z.getAll(t.username,e).then(o=>{t.notelist.splice(0,t.notelist.length,...o.data)})},b=()=>{m.value!=null&&(m.value.visible=!0)};C({visible:i});const h=()=>{if(t.current_storage.length==0||l.value.length==0||t.notelist.findIndex(o=>o.notename==l.value)!=-1||a.value)return;a.value=!0;const e=new Y;e.isPublic=1,e.userid=t.userid,e.notename=l.value,e.bookname=t.current_storage,e.username=t.username,e.collections=0,e.goods=0,e.content="",z.insertOne(e).then(o=>{o.data!=null&&(t.notelist.splice(0,0,o.data),l.value="",M({type:"success"}))}).finally(()=>{a.value=!1})},x=_(!1),k=_(""),p=_(""),V=e=>{p.value=e.notename,k.value=e.notename,x.value=!0},u=()=>{var o;if(p.value.replaceAll(" ","").length==0||p.value==k.value)return;for(let g of t.notelist)if(g.notename==p.value){M({type:"info",message:" name repeat"});return}let e=(o=t.notelist.find(g=>g.notename=k.value))==null?void 0:o.noteid;z.rename(p.value,e).then(g=>{if(g.data=="1"){for(let w of t.notelist)if(w.notename==k.value){w.notename=p.value,t.current_notename==k.value&&(t.current_notename=p.value);break}x.value=!1,M({type:"success"})}})},v=e=>{z.deleteOne(e.noteid).then(o=>{o.data=="1"&&(t.notelist.splice(t.notelist.findIndex(g=>g.noteid==e.noteid),1),e.notename==t.current_notename&&(t.current_notename=""))})},n=e=>{t.current_notename=e.notename,i.value=!1};return(e,o)=>{const g=c("el-button"),w=c("el-dropdown-item"),F=c("el-dropdown-menu"),q=c("el-dropdown"),P=c("el-space"),D=c("el-input"),X=c("el-dialog"),te=c("el-scrollbar");return y(),S(X,{modelValue:i.value,"onUpdate:modelValue":o[3]||(o[3]=$=>i.value=$),"show-close":!1,width:"60%"},{header:r(()=>[s(P,null,{default:r(()=>[s(q,{onCommand:d},{dropdown:r(()=>[s(F,null,{default:r(()=>[(y(!0),R(A,null,B(N(t).storages.map($=>$.bookname),$=>(y(),S(w,{command:$},{default:r(()=>[U(j($),1)]),_:2},1032,["command"]))),256))]),_:1})]),default:r(()=>[s(g,{type:"primary"},{default:r(()=>[U(j(N(t).current_storage),1)]),_:1})]),_:1}),s(g,{type:"primary",onClick:b},{default:r(()=>[U("manage")]),_:1})]),_:1})]),footer:r(()=>[s(D,{modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=$=>l.value=$),placeholder:"create article",clearable:"",onChange:h},null,8,["modelValue"])]),default:r(()=>[s(X,{modelValue:x.value,"onUpdate:modelValue":o[2]||(o[2]=$=>x.value=$),"align-center":""},{default:r(()=>[s(P,{wrap:""},{default:r(()=>[we,s(D,{modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=$=>p.value=$),onChange:u},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),s(be,{ref_key:"storage_dialog_ref",ref:m},null,512),s(te,{height:"480px"},{default:r(()=>[I("div",ye,[(y(!0),R(A,null,B(N(t).notelist,$=>(y(),S(ie,{onDelete:v,onEdit:V,onVisit:n,"note-info":$,"can-edit":!0},null,8,["note-info"]))),256))])]),_:1})]),_:1},8,["modelValue"])}}});const xe=L(ke,[["__scopeId","data-v-c59358e6"]]),$e={class:"card-container"},Ie=O({__name:"ResourceInfo",props:{resourceInfo:null},emits:["delete","downland","rename"],setup(f,{emit:C}){const a=f,t=()=>{let l=`/${a.resourceInfo.username}/${a.resourceInfo.bookname}/${a.resourceInfo.notename}/${a.resourceInfo.name}`;ee.indexOf(a.resourceInfo.type)!=-1?l="/image"+l:ne.indexOf(a.resourceInfo.type)!=-1&&(l="/video"+l),l=E.base_url+"/static"+l,navigator.clipboard.writeText(l),M({type:"success",message:"Copy to clipboard"})};return(l,i)=>{const m=c("el-input"),d=c("el-button"),b=c("el-dropdown-item"),h=c("el-dropdown-menu"),x=c("el-dropdown"),k=c("el-card");return y(),S(k,{class:"box-card",shadow:"hover"},{default:r(()=>[I("div",$e,[s(m,{class:"card-input",disabled:"",modelValue:f.resourceInfo.name,"onUpdate:modelValue":i[0]||(i[0]=p=>f.resourceInfo.name=p),placeholder:"Please input",size:"small"},null,8,["modelValue"]),I("span",null,j(f.resourceInfo.type),1),s(x,null,{dropdown:r(()=>[s(h,null,{default:r(()=>[s(b,null,{default:r(()=>[s(d,{type:"primary",size:"small",onClick:i[1]||(i[1]=p=>C("rename",f.resourceInfo))},{default:r(()=>[U("rename")]),_:1})]),_:1}),s(b,null,{default:r(()=>[s(d,{size:"small",onClick:i[2]||(i[2]=p=>C("delete",f.resourceInfo))},{default:r(()=>[U("delete")]),_:1})]),_:1})]),_:1})]),default:r(()=>[s(d,{type:"primary",size:"small"},{default:r(()=>[U(" opera ")]),_:1})]),_:1}),s(d,{size:"small",onClick:t},{default:r(()=>[U("path")]),_:1})])]),_:1})}}});const Ce=L(Ie,[["__scopeId","data-v-75c3a0cd"]]),le=f=>(K("data-v-a038446c"),f=f(),Q(),f),De={class:"body"},Se={class:"container"},Ee=le(()=>I("div",null,[U(" Drop file here or "),I("em",null,"click to upload")],-1)),Ue=le(()=>I("span",null,"rename",-1)),Me=O({__name:"ResourceManagerDraw",setup(f,{expose:C}){const a=_(!0);J();const t=_(""),l=T([...Array(0).keys()].map(n=>{const e=new ae;return e.bookname=" bookname",e.name="name",e}));C({visible:a,refresh:n=>{if(n==""){l.splice(0,l.length),t.value="";return}t.value=n,E.getAllInfo(n).then(e=>{l.splice(0,l.length,...e.data.filter(o=>o.name!="__content__"))})}});const m=_(!1),d=_(""),b=_(""),h=n=>{E.deleteOne(t.value,n.name).then(e=>{e.data=="1"&&l.splice(l.findIndex(o=>o.name==n.name),1)})},x=n=>{b.value=n.name,d.value=n.name,m.value=!0},k=()=>{d.value.replaceAll(" ","").length==0||l.findIndex(n=>n.name==d.value)!=-1||d.value!=="__content__"&&E.rename(t.value,b.value,d.value).then(n=>{n.data=="1"&&(m.value=!1,l.find(e=>e.name==b.value).name=d.value)})},p=n=>{ee.indexOf(n.type)!=-1?window.location.href=E.base_url+`/static/image/${n.username}/${n.bookname}/${n.notename}/${n.name}`:ne.indexOf(n.type)!=-1?window.location.href=E.base_url+`/static/video/${n.username}/${n.bookname}/${n.notename}/${n.name}`:window.location.href=E.base_url+`/static/${n.username}/${n.bookname}/${n.notename}/${n.name}`},V=_("");_(""),T([]);const u=_(!1),v=n=>{if(u.value)return;console.log(n);let e=V.value;if((V.value.replaceAll(" ","").length==0||l.findIndex(o=>o.name==V.value)!=-1)&&(l.findIndex(o=>o.name==n.name)!=-1?e=n.name+"-"+new Date().getTime():e=n.name),t.value!=null)return u.value=!0,E.uploadData(t.value,e,n).then(o=>{console.log(o.data),o.data!=null&&l.push(o.data)}).finally(()=>{u.value=!1}),!1};return(n,e)=>{const o=c("el-scrollbar"),g=c("el-input"),w=c("el-space"),F=c("el-upload"),q=c("el-dialog"),P=c("el-drawer");return y(),S(P,{modelValue:a.value,"onUpdate:modelValue":e[3]||(e[3]=D=>a.value=D),"show-close":!1,size:N(me)?"80%":""},{default:r(()=>[I("div",De,[s(o,{height:"500px"},{default:r(()=>[I("div",Se,[(y(!0),R(A,null,B(l,D=>(y(),S(Ce,{onDelete:h,onRename:x,onDownland:p,"resource-info":D},null,8,["resource-info"]))),256))])]),_:1}),s(w,null,{default:r(()=>[s(g,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=D=>V.value=D),placeholder:"resource name"},null,8,["modelValue"])]),_:1}),s(F,{class:"upload",drag:"","before-upload":v},{default:r(()=>[Ee]),_:1})]),s(q,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=D=>m.value=D),"align-center":""},{default:r(()=>[s(w,{wrap:""},{default:r(()=>[Ue,s(g,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=D=>d.value=D),onChange:k},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue","size"])}}});const Ne=L(Me,[["__scopeId","data-v-a038446c"]]),Re={class:"container"},Ae=O({__name:"EditModelListDialog",setup(f,{expose:C}){const a=_(!1),t=_(""),l=_(!1),i=T([...Array(0).keys()].map(b=>{const h=new se;return h.dsc="dsc",h.username="username",h.name="name",h}));C({visible:l});const m=()=>{if(t.value.replaceAll(" ","").length==0){d();return}a.value||(a.value=!0,i.splice(0,i.length),_e.search(t.value,0).then(b=>{i.splice(0,i.length,...b.data)}).finally(()=>{a.value=!1}))},d=()=>{i.splice(0,i.length)};return(b,h)=>{const x=c("el-input"),k=c("el-scrollbar"),p=c("el-dialog");return y(),S(p,{modelValue:l.value,"onUpdate:modelValue":h[1]||(h[1]=V=>l.value=V),"show-close":!1,width:"60%"},{header:r(()=>[s(x,{modelValue:t.value,"onUpdate:modelValue":h[0]||(h[0]=V=>t.value=V),placeholder:"search for edit model",clearable:"",onChange:m},null,8,["modelValue"])]),default:r(()=>[s(k,{height:"500px"},{default:r(()=>[I("div",Re,[(y(!0),R(A,null,B(i,V=>(y(),S(pe,{"edit-model":V,"can-edit":!1},null,8,["edit-model"]))),256))])]),_:1})]),_:1},8,["modelValue"])}}});const Oe=L(Ae,[["__scopeId","data-v-24016ba1"]]),Le={class:"container"},ze=O({__name:"NoteEditView",setup(f){const C=J(),a=H(),t=re(),l=T(new Y),i=T([]),m=_(null),d=_(null),b=_(null),h=()=>{d.value!=null&&(d.value.visible=!0)},x=()=>{m.value!=null&&(m.value.visible=!0)},k=()=>{b.value!=null&&(b.value.visible=!0)};let p;const V=_(""),u=_("");Z(()=>{if(p=a.$subscribe((n,e)=>{if(V.value!=e.current_storage||u.value!=e.current_notename){if(V.value=e.current_storage,u.value=e.current_notename,e.current_storage==""||e.current_notename==""){for(let o in l)l[o]=void 0;l.content="",i.splice(0,i.length)}else z.getOneByFull(e.username,e.current_storage,e.current_notename).then(o=>{if(o.data!=null){for(let g in o.data)l[g]=o.data[g];d.value.refresh(o.data.noteid),E.findTextByFullName(e.username,e.current_storage,e.current_notename,"__content__").then(g=>{l.content=g.data}),console.log(l)}});d.value.refresh(a.current_notename==""||a.current_notename==null?"":l.noteid)}console.log("modify",e.current_storage,e.current_notename)}),a.token==null){C.push("/visit/login");return}}),ue(()=>{p()});const v=()=>{if(a.current_storage==""||a.current_notename==""){M({type:"info",message:"invalid article"});return}E.updateOne(l.noteid,"__content__",new Blob([l.content],{type:"text/plain"})).then(n=>{n.data=="1"&&M({type:"info",message:"saved"})})};return(n,e)=>{const o=c("v-md-editor");return y(),R(A,null,[I("div",Le,[s(o,{onSave:v,modelValue:l.content,"onUpdate:modelValue":e[0]||(e[0]=g=>l.content=g),height:N(t).height-60+"px"},null,8,["modelValue","height"])]),s(G,{text:"catalog","link-type":"event",onClick:x}),N(a).current_notename.length!=0?(y(),S(G,{key:0,text:"resource","link-type":"event",bottom:160,onClick:h})):de("",!0),s(G,{text:"EditModel","link-type":"event",bottom:220,onClick:k}),s(xe,{ref_key:"catalog_dialog_ref",ref:m},null,512),s(Ne,{ref_key:"resource_dialog_ref",ref:d},null,512),s(Oe,{ref_key:"edit_model_dialog_ref",ref:b},null,512)],64)}}});const Je=L(ze,[["__scopeId","data-v-53c5bba6"]]);export{Je as default};
